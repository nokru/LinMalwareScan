#!/bin/bash

sudo apt-get --yes update
sudo DEBIAN_FRONTEND=noninteractive DEBIAN_PRIORITY=critical apt-get -q -y -o "Dpkg::Options::=--force-confdef" -o "Dpkg::Options::=--force-confold" upgrade


sudo apt-get --yes install nano git ssh ntp nfs-common samba-common
sudo service ntp restart

#Install required packages for alpine
sudo apt-get --yes install py-pip python-dev libffi-dev openssl-dev gcc libc-dev make


#Set Timezone right
sudo echo Europe/Vienna > /etc/timezone


#checkout
cd /opt
git clone https://github.com/nokru/LinMalwareScan.git

cd /opt/LinMalwareScan/
git pull
sudo chmod +x /opt/LinMalwareScan/bootstrap.sh
#sudo /opt/LinMalwareScan/bootstrap.sh

#php malware finder
sudo apt-get --yes install yara

cd /opt
git clone https://github.com/jvoisin/php-malware-finder.git
cd ./php-malware-finder
chmod +x phpmalwarefinder
#./phpmalwarefinder


#maldetect
sudo apt-get install clamav -y

cd /tmp
wget https://www.rfxn.com/downloads/maldetect-current.tar.gz
tar -xf maldetect-current.tar.gz
rm -rf maldetect-current.tar.gz
cd maldetect*
sudo bash install.sh

sudo maldet --update-ver
sudo maldet --update-sigs


#lynis auditing
cd /opt
git clone https://github.com/CISOfy/lynis
#cd lynis; sudo ./lynis audit system > /opt/lynis.txt


#chkroot installieren
sudo apt-get --yes install chkrootkit
#sudo chkrootkit > /opt/chkrootkit.txt


#rkhunter installieren
sudo apt-get --yes install rkhunter
#sudo rkhunter -c > /opt/rkhunter.txt


#get yara rules
cd /opt
git clone https://github.com/Yara-Rules/rules.git
sed '/PoetRATPython/d' ./rules/malware_index.yar > ./rules/malware_index.yar
sed '/PoetRATPython/d' ./rules/index_w_mobile.yar > ./rules/index_w_mobile.yar


#for vmdk mount 
sudo apt-get --yes install affuse

#sample yara calls
#yara -r --no-warnings rules/antidebug_antivm_index.yar /usr/bin/
#yara -r --no-warnings rules/capabilities_index.yar /usr/bin/
#yara -r --no-warnings rules/crypto_index.yar /usr/bin/
#yara -r --no-warnings rules/cve_rules_index.yar /usr/bin/
#yara -r --no-warnings rules/email_index.yar /usr/bin/
#yara -r --no-warnings rules/exploit_kits_index.yar /usr/bin/
#yara -r --no-warnings rules/index_w_mobile.yar /usr/bin/
#yara -r --no-warnings rules/maldocs_index.yar /usr/bin/
#yara -r --no-warnings rules/malware_index.yar /usr/bin/
#yara -r --no-warnings rules/mobile_malware_index.yar /usr/bin/
#yara -r --no-warnings rules/packers_index.yar /usr/bin/
#yara -r --no-warnings rules/webshells_index.yar /usr/bin/


